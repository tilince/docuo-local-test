# 使用 Token 鉴权


## 简介

为了避免未经授权的服务访问或操作，ZEGO 使用 Token 来验证用户身份、控制及验证用户权限，因此您需要在登录房间时传入 Token。

## 实现流程

import TokenImplementationProcessAudioroom from "/snippets/Reuse/Token_Implementation_Process_Audioroom-zh.mdx";

<TokenImplementationProcessAudioroom/>

<Note title="注意">roomID 即 callID。</Note>

### 获取 AppID 和 ServerSecret

生成 Token 需要开发者项目的唯一标识 AppID 和密钥 ServerSecret，请参考 [控制台 - 项目管理](https://doc-zh.zego.im/article/) 中的 “项目信息”获取。

## 在您的服务器上生成 Token

开发者获得项目的 AppID 和 ServerSecret 信息后，根据实际业务需求，即可在自己的服务端生成 Token。开发者客户端向开发者服务端发送申请 Token 请求，由开发者服务端生成 Token 后返回给到对应客户端。

ZEGO 在 GitHub/Gitee 提供了一个开源的 zego_server_assistant 插件，支持使用 Go、C++、Java、Objective-C、Python、PHP、.NET、Node.js 语言生成 Token：

<Warning title="Warning">
出于业务安全考虑，您必须在应用服务器上生成 Token，否则，存在 ServerSecret 被盗取的风险。
</Warning>

<table>
<tbody><tr>
<th>语言</th>
<th>支持版本</th>
<th>关键函数</th>
<th>代码库地址</th>
<th>基础鉴权 Token</th>
</tr>
<tr>
<td>Go</td>
<td>Go 1.14.15 或以上版本</td>
<td>GenerateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/go/src/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/go/src/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/go/sample/token04/sample-base.go">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/go/sample/token04/sample-base.go">Gitee</a></li></ul></td>
</tr>
<tr>
<td>C++</td>
<td>C++ 11 或以上版本</td>
<td>GenerateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/c%2B%2B/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/c++/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/c%2B%2B/token04/sample/demo/main.cc">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/c%2B%2B/token04/sample/demo/main.cc">Gitee</a></li></ul></td>
</tr>
<tr>
<td>Java</td>
<td>Java 1.8 或以上版本</td>
<td>generateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/java/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/java/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/java/token04/src/im/zego/serverassistant/sample/Token04SampleBase.java">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/java/token04/src/im/zego/serverassistant/sample/Token04SampleBase.java">Gitee</a></li></ul></td>
</tr>
<tr>
<td>Python</td>
<td>Python 3.6.8 或以上版本</td>
<td>generate_token04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/python/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/python/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/python/token04/test/base_sample.py">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/python/token04/test/base_sample.py">Gitee</a></li></ul></td>
</tr>
<tr>
<td>PHP</td>
<td>PHP 5.6 或以上版本</td>
<td>generateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/php/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/php/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant_php/blob/main/test/test.php">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/php/token04/test/test.php">Gitee</a></li></ul></td>
</tr>
<tr>
<td>.NET</td>
<td>.NET Framework 3.5 或以上版本</td>
<td>GenerateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/.net/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/.net/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/feature/token04/token/.net/token04/demo/WindowsFormsApp1/Form1.cs">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/feature/token04/token/.net/token04/demo/WindowsFormsApp1/Form1.cs">Gitee</a></li></ul></td>
</tr>
<tr>
<td>Node.js</td>
<td>Node.js 8 或以上版本</td>
<td>generateToken04</td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/tree/release/github/token/nodejs/token04">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/tree/release/github/token/nodejs/token04">Gitee</a></li></ul></td>
<td><ul><li><a target="_blank" href="https://github.com/zegoim/zego_server_assistant/blob/release/github/token/nodejs/token04/sample/sample-base.js">GitHub</a></li><li><a target="_blank" href="https://gitee.com/zegodev_admin/zego_server_assistant/blob/release/github/token/nodejs/token04/sample/sample-base.js">Gitee</a></li></ul></td>
</tr>
</tbody></table>



## 如何获取临时 Token 

为方便开发者调试，[ZEGO 控制台](https://console.zego.im/) 提供生成临时 Token 的功能，开发者可直接获取临时 Token 来使用，详情请参考 [控制台 - 开发辅助](https://doc-zh.zego.im/article/16309)。但是在开发者自己的线上环境中，一定要通过自己的服务端生成 Token。

## 使用 Token 

如果你需要使用 Token 而不是 Appsign，可以调用 `newInstanceWithToken` 完成初始化。

```java
ZegoUIKitPrebuiltCallFragment.newInstanceWithToken(appID, appToken, userID, userName, callID, config);
```

如果您使用通话邀请功能，请调用 `initWithToken` 方法完成初始化。

```java
ZegoUIKitPrebuiltCallService.initWithToken(getApplication(), appID, token, userID, userName, callInvitationConfig);
```

## 更新 Token 

在某些极端情况下，上述提到的 Token 获取方法可能不可靠。为确保 Token 的可靠性，您可以进行以下修改：

1. Token 的有效期应尽可能设置得较长，例如 3 天。
2. 监听 `onTokenWillExpire` 回调，并调用 `renewToken` 更新为新的 Token。

    ```java
    ZegoUIKit.setTokenWillExpireListener(new ZegoUIKitTokenExpireListener() {
        @Override
        public void onTokenWillExpire(int second) {
            // ...
            ZegoUIKit.renewToken(token);
        }
    });
    ```
3. 在适当的时间续订 Token ，例如，当 App 进入前台时。

   ```java
   // ...
    ZegoUIKit.renewToken(token)
   ```

## 关于美颜插件

若您使用互动直播 UIKit 的美颜插件，如不想使用 AppSign，您也可以使用 Licence 许可证进行初始化，实现方式如下：

<Warning title="Warning">
- 已联系 ZEGO 技术支持，开通 UIKit 美颜相关功能，并参考 [AI 美颜-在线鉴权](https://doc-zh.zego.im/article/11987) 文档，获取 License 进行在线鉴权。
- 请确保在获取到您的 Licence 许可证后，调用 `BeautyPluginLicenseSetter.setLicence(context, license);` 初始化美颜服务。
</Warning>

```java
ZegoUIKit.getBeautyPlugin().setLicenceProvider(new LicenceProvider() {
    @Override
    public void onLicenseRequired(BeautyPluginLicenseSetter setter) {
        //.. 向您的服务器请求许可证的 HTTP 请求
        httpRequest.enqueue(new CallBack(){
            //
            setter.setLicence(context, license);
        });
    }
});
```